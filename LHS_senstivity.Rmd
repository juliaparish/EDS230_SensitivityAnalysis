---
title: "Sensitivity Analysis - Latin Hypercube Sampling"
author: "Paloma Cartwright, Juliet Cohen, Julia Parish"
date: '2022-04-26'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(here)
library(SciViews) # ln() function
library(pse)
library(purrr)
```

# Sensitivity Analysis - Latin Hypercube Sampling


This environmental model was completed as an assignment for the course, Environmental Data Science 230 | Environmental Science & Management: Modeling Environmental Systems. The goal of this assignment was to build a model ... and conduct a ... . The model design is based on



## 1. Code a function to compute atmospheric conductance Cat (how easily vapor diffuses from vegetation surfaces)

```{r}
source(here("atmcon.R"))
```

## 2. Run `atmcon` model and provide with a single estimate of atmospheric conductance for this forest.  

```{r}
ac_forest <- atmcon(vm = 250, h = 1000)
ac_forest

ac_forest_rounded <- round(ac_forest[[1]], 2)

print(paste0("The atmospheric conductance for this vegetation is ", ac_forest_rounded, " centimeters per second."))
```

## 3. Conduct a sensitivity analysis
Consider the sensitivity of estimates to uncertainty in the following parameters and inputs:
- *h*
- *k~d*
- *k~0*
- *v*

```{r}
factors = c("vm", "h", "kd", "k")

nsets = 100

q = c("qnorm", "qunif", "qnorm", "qnorm")

q.arg = list(list(mean = 250, sd = 30), 
             list(min = 950, max = 1050), 
             list(mean = 0.7, sd = 0.07), 
             list(mean = 0.1, sd = 0.01))
q.arg

# generate samples
sens_ac = LHS(NULL, factors, nsets, q, q.arg)
#sens_ac
#summary(sens_ac)
#sens_ac$data
# NULL indicates there is no model
sens_pars <- get.data(sens_ac)
sens_pars
```

## Summary of results

```{r}
source(here("atmcon.R"))
ac_lhs <- pmap(sens_pars, atmcon)
head(ac_lhs[[2]])
```

```{r}
atmospheric_conductances <- ac_lhs %>% 
  map_dfr(`[`, "ac")

atmospheric_conductances
```

## C. Graph

```{r}
#data <- atmospheric_conductances %>% 
#  gather(value = "value", key = )

ggplot(data = atmospheric_conductances, aes(y = ac)) +
  geom_boxplot() +
  labs(y = "Atmospheric Conductance") +
  #theme(x = element_blank()) +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank())
  
```

## D. Graph

```{r}
#pse::plotscatter(sens_ac)
```

## E. Plot PRCC

## F. Discussion

## References








